\
{% extends 'dashboard/base_dashboard_new.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{{ page_title|default:"Record Installment" }} | {{ block.super }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="bg-white shadow-lg rounded-lg p-6 md:p-8">
        <h1 class="text-2xl font-semibold text-gray-800 mb-6">{{ page_title|default:"Record Installment" }}</h1>

        {% if messages %}
            {% for message in messages %}
                <div class="mb-4 p-4 rounded-md {% if message.tags == 'success' %}bg-green-100 text-green-700{% elif message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <div class="mb-6 p-4 border border-gray-200 rounded-md bg-gray-50">
            <h2 class="text-lg font-medium text-gray-700 mb-2">Payment Details</h2>
            {% if entry_fee_payment %}
                <p><strong>Type:</strong> Entry Fee</p>
                <p><strong>Member:</strong> {{ entry_fee_payment.kikoba_membership.user.name|default:entry_fee_payment.kikoba_membership.user.username }}</p>
                <p><strong>Total Due:</strong> {{ entry_fee_payment.amount_due }}</p>
                <p><strong>Amount Paid:</strong> {{ entry_fee_payment.amount_paid }}</p>
                <p><strong>Remaining Due:</strong> {% widthratio entry_fee_payment.amount_due 1 entry_fee_payment.amount_paid as remaining_due %}{{ entry_fee_payment.amount_due|add:0|sub:entry_fee_payment.amount_paid|add:0 }}</p>
                <p><strong>Status:</strong> {% if entry_fee_payment.is_fully_paid %}Fully Paid{% else %}Partially Paid / Unpaid{% endif %}</p>
            {% elif share_contribution %}
                <p><strong>Type:</strong> Share Contribution</p>
                <p><strong>Member:</strong> {{ share_contribution.kikoba_membership.user.name|default:share_contribution.kikoba_membership.user.username }}</p>
                <p><strong>Period:</strong> {{ share_contribution.period_start }} - {{ share_contribution.period_end }}</p>
                <p><strong>Total Due:</strong> {{ share_contribution.amount_due }}</p>
                <p><strong>Amount Paid:</strong> {{ share_contribution.amount_paid }}</p>
                <p><strong>Remaining Due:</strong> {{ share_contribution.amount_due|add:0|sub:share_contribution.amount_paid|add:0 }}</p>
                <p><strong>Status:</strong> {% if share_contribution.is_fully_paid %}Fully Paid{% else %}Partially Paid / Unpaid{% endif %}</p>
            {% else %}
                <p class="text-gray-500">No payment details available.</p>
            {% endif %}
        </div>

        <form method="post" novalidate>
            {% csrf_token %}
            {{ form|crispy }}
            <div class="mt-8 flex justify-end space-x-3">
                {% if entry_fee_payment %}
                    <a href="{% url 'groups:record_entry_fee_payment' kikoba_id=current_kikoba.id member_id=member.id %}" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Back to Payment
                    </a>
                {% elif share_contribution %}
                     <a href="{% url 'groups:record_share_contribution' kikoba_id=current_kikoba.id member_id=member.id %}" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Back to Contribution
                    </a>
                {% endif %}
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-bright-red rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bright-red">
                    Save Installment
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
